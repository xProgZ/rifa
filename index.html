<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Rifa Solid√°ria</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f4f7fb;
      padding-bottom: 40px;
    }
    h1 { color:#333; margin-top:18px; }
    .contador { font-size:16px; font-weight:700; color:#444; margin:8px 0 12px; }
    .busca { margin: 12px 0; }
    input[type="number"] {
      padding:8px; width:80px; font-size:16px; text-align:center;
      border:1px solid #ccc; border-radius:6px; margin-right:6px;
    }
    .botoes { margin:12px 0 18px; }
    button {
      padding:10px 14px; border:none; border-radius:6px;
      background:#007bff; color:#fff; font-size:14px; cursor:pointer; margin:6px;
    }
    button:hover { background:#0056b3; }
    .grid {
      display:grid;
      grid-template-columns: repeat(10, 1fr);
      gap:8px;
      max-width:760px;
      margin: 0 auto;
      padding: 0 10px;
    }
    .numero {
      padding:10px;
      background:#fff;
      border:1px solid #ccc;
      border-radius:8px;
      cursor:pointer;
      font-weight:700;
      font-size:13px;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:44px;
      word-break:break-word;
    }
    .numero:hover { background:#e9f4ff; }
    .selecionado { background:#ff5252; color:#fff; }
    .highlight {
      animation: piscar 1s ease-in-out 3;
      border: 2px solid #007bff !important;
    }
    @keyframes piscar {
      0%,100% { background: #fff59d; }
      50% { background: #fff; }
    }
    @media (max-width:600px) {
      .grid { grid-template-columns: repeat(5, 1fr); max-width: 360px; }
    }
  </style>
</head>
<body>
  <h1>üéüÔ∏è Rifa Solid√°ria para tratamento do Sr. Onofre</h1>

  <div class="contador" id="contador">Selecionados: 0 / 250</div>

  <div class="busca">
    <input type="number" id="numeroBusca" min="1" max="250" placeholder="N¬∫">
    <button id="buscar">üîç Buscar</button>
  </div>

  <div class="botoes">
    <button id="exportar">üìÇ Exportar Sele√ß√µes (TXT)</button>
    <button id="limpar">üîÑ Limpar Sele√ß√µes</button>
    <button onclick="sortearGanhador()">üé≤ Sortear Ganhador</button>
  </div>

  <div class="grid" id="tabela-numeros"></div>

  <script>
    const tabela = document.getElementById('tabela-numeros');
    const contador = document.getElementById('contador');
    const btnBuscar = document.getElementById('buscar');
    const inputBusca = document.getElementById('numeroBusca');
    const btnExportar = document.getElementById('exportar');
    const btnLimpar = document.getElementById('limpar');

    let selecionados = JSON.parse(localStorage.getItem('rifaSelecionados')) || {};

    function atualizarContador() {
      contador.textContent = `Selecionados: ${Object.keys(selecionados).length} / 250`;
    }

    // Gera grid
    for (let i = 1; i <= 250; i++) {
      const div = document.createElement('div');
      div.className = 'numero';
      div.id = 'num-' + i;
      div.dataset.n = i;
      if (selecionados[String(i)]) {
        const nome = selecionados[String(i)];
        div.classList.add('selecionado');
        div.textContent = `${i} - ${nome}`;
        div.title = `Comprado por: ${nome}`;
      } else {
        div.textContent = i;
      }

      div.addEventListener('click', () => {
        const key = String(i);
        if (!div.classList.contains('selecionado')) {
          const nome = prompt(`Digite o nome da pessoa que comprou o n¬∫ ${i}:`);
          if (nome === null) return;
          const trimmed = nome.trim();
          if (trimmed === '') {
            alert('Nome vazio. Opera√ß√£o cancelada.');
            return;
          }
          selecionados[key] = trimmed;
          localStorage.setItem('rifaSelecionados', JSON.stringify(selecionados));
          div.classList.add('selecionado');
          div.textContent = `${i} - ${trimmed}`;
          div.title = `Comprado por: ${trimmed}`;
          atualizarContador();
        } else {
          const atual = selecionados[key] || '';
          const novo = prompt(`Editar nome do n¬∫ ${i} (deixe vazio para REMOVER):`, atual);
          if (novo === null) return;
          const trimmed = novo.trim();
          if (trimmed === '') {
            if (confirm(`Deseja remover o registro do n√∫mero ${i}?`)) {
              delete selecionados[key];
              localStorage.setItem('rifaSelecionados', JSON.stringify(selecionados));
              div.classList.remove('selecionado');
              div.textContent = i;
              div.title = '';
              atualizarContador();
            }
          } else {
            selecionados[key] = trimmed;
            localStorage.setItem('rifaSelecionados', JSON.stringify(selecionados));
            div.textContent = `${i} - ${trimmed}`;
            div.title = `Comprado por: ${trimmed}`;
            atualizarContador();
          }
        }
      });

      tabela.appendChild(div);
    }

    atualizarContador();

    // Buscar n√∫mero
    btnBuscar.addEventListener('click', () => {
      const val = parseInt(inputBusca.value);
      if (Number.isInteger(val) && val >= 1 && val <= 250) {
        const el = document.getElementById('num-' + val);
        if (!el) return;
        el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        el.classList.add('highlight');
        setTimeout(() => el.classList.remove('highlight'), 3000);
      } else {
        alert('Digite um n√∫mero v√°lido entre 1 e 250!');
      }
    });

    // Exportar TXT
    btnExportar.addEventListener('click', () => {
      const keys = Object.keys(selecionados);
      if (keys.length === 0) {
        alert('Nenhum n√∫mero foi selecionado!');
        return;
      }
      const entries = keys.map(k => [Number(k), selecionados[k]])
                          .sort((a,b) => a[0] - b[0]);
      const linhas = ['N√∫meros selecionados:', ''];
      for (const [num, nome] of entries) {
        linhas.push(`N¬∫ ${num} - ${nome}`);
      }
      const conteudo = linhas.join('\n');
      const blob = new Blob([conteudo], { type:'text/plain;charset=utf-8' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'rifa_selecionados.txt';
      link.click();
    });

    // Limpar sele√ß√µes
    btnLimpar.addEventListener('click', () => {
      if (!confirm('Tem certeza que deseja limpar TODAS as sele√ß√µes?')) return;
      selecionados = {};
      localStorage.removeItem('rifaSelecionados');
      document.querySelectorAll('.numero').forEach(n => {
        n.classList.remove('selecionado');
        n.title = '';
        n.textContent = n.dataset.n;
      });
      atualizarContador();
    });

    // Sortear ganhador
    function sortearGanhador() {
      const keys = Object.keys(selecionados);
      if (keys.length === 0) {
        alert('Nenhum n√∫mero foi selecionado ainda!');
        return;
      }
      const randomIndex = Math.floor(Math.random() * keys.length);
      const numero = keys[randomIndex];
      const nome = selecionados[numero];
      alert(`üéâ O ganhador √©:\n\nN¬∫ ${numero} - ${nome}`);
    }
  </script>
</body>
</html>
